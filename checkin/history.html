<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“å¡å›é¡¾å¢™ - è®­ç»ƒè¥</title>
    <link rel="stylesheet" href="style.css">
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.0/dist/umd/supabase.js"></script>
    <!-- html2canvas for screenshot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* è¦†ç›–é»˜è®¤ container æ ·å¼ï¼Œå…è®¸æ›´å®½çš„å±•ç¤º */
        .container {
            max-width: 600px !important; /* ä¸ checkin é¡µé¢ä¿æŒä¸€è‡´çš„èˆ’é€‚å®½åº¦ */
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid var(--stroke);
            padding-bottom: 1rem;
        }
        .date-nav {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding-bottom: 10px;
            margin-bottom: 20px;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .date-nav::-webkit-scrollbar {
            display: none;
        }
        .date-pill {
            padding: 8px 16px;
            background: var(--panel);
            border: 1px solid var(--stroke);
            border-radius: 20px;
            color: var(--muted);
            text-decoration: none;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .date-pill.active {
            background: var(--yellow);
            color: #000;
            border-color: #000;
            font-weight: bold;
        }
        /* ç€‘å¸ƒæµæ”¹ä¸ºå•åˆ—æµï¼Œæ›´åƒ Ins Timeline */
        .waterfall {
            column-count: 1; 
            width: 100%;
        }
        
        /* åˆ†äº«æŒ‰é’®æ ·å¼ */
        .share-btn {
            background: transparent;
            border: none;
            color: var(--muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .share-btn:hover {
            background: rgba(255,255,255,0.1);
            color: var(--primary);
        }

        /* å¯¼å‡ºå›¾ç‰‡çš„é•¿å›¾å®¹å™¨ (éšè—) */
        #export-container {
            position: fixed;
            top: 0;
            left: -9999px;
            width: 375px;
            padding: 40px 32px;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            box-sizing: border-box;
            border: none;
            box-shadow: none;

            /* 
               é«˜çº§è´¨æ„ŸèƒŒæ™¯ï¼šé™è°§ç”µæ³¢ (Silent Wave) V2
               ä½¿ç”¨æ˜¾å¼ DOM å…ƒç´ æ¥ç»˜åˆ¶çº¹ç†ï¼Œé¿å… html2canvas é—æ¼ CSS èƒŒæ™¯
            */
            background-color: #F2F4F7;
            position: fixed;
        }

        /* æ˜¾å¼è£…é¥°å…ƒç´ æ ·å¼ */
        .deco-circle {
            position: absolute;
            top: -100px;
            right: -100px;
            width: 400px;
            height: 400px;
            border-radius: 50%;
            background: repeating-radial-gradient(
                circle,
                transparent 0,
                transparent 19px,
                rgba(0, 0, 0, 0.06) 19px,
                rgba(0, 0, 0, 0.06) 20px
            );
            z-index: 0;
            pointer-events: none;
        }

        .deco-grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0, 0, 0, 0.04) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 0, 0, 0.04) 1px, transparent 1px);
            background-size: 20px 20px;
            z-index: 0;
            pointer-events: none;
        }

        .deco-corner {
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid #000;
            z-index: 1;
        }

        .deco-corner.top-left {
            top: 20px;
            left: 20px;
            border-right: none;
            border-bottom: none;
        }

        .deco-corner.bottom-right {
            bottom: 20px;
            right: 20px;
            border-left: none;
            border-top: none;
        }

        /* ç§»é™¤æ—§çš„èƒŒæ™¯ CSSï¼Œå®Œå…¨ä¾é  DOM å…ƒç´  */
        /* ç¡®ä¿å†…å®¹åœ¨èƒŒæ™¯ä¹‹ä¸Š */
        .export-header-simple, #exportContent, .export-footer-simple {
            position: relative;
            z-index: 2;
        }
        
        .export-header-simple {
            margin-bottom: 40px;
            padding-bottom: 24px;
            border-bottom: 2px solid #000;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .export-user-block h1 {
            font-size: 24px;
            font-weight: 700;
            margin: 0 0 8px 0;
            color: #000;
            letter-spacing: -0.5px;
            line-height: 1.1;
        }
        
        .export-user-block p {
            font-size: 12px;
            color: #666;
            margin: 0;
            font-family: 'Space Grotesk', monospace;
            letter-spacing: 0.5px;
        }

        /* æ›¿æ¢ Logo æ ·å¼ */
        .export-logo {
            height: 20px;
            width: auto;
            margin-top: 2px;
        }

        .export-section {
            margin-bottom: 32px;
            /* ç§»é™¤åŸæ¥çš„èƒŒæ™¯è‰²å’Œè¾¹æ¡† */
            background: transparent;
            padding: 0;
            border: none;
            border-radius: 0;
        }

        .export-section-title {
            font-size: 14px;
            font-weight: 700;
            color: #000;
            margin-bottom: 12px;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* æ ‡é¢˜å‰çš„å°æ–¹å—è£…é¥° */
        .export-section-title::before {
            content: '';
            display: block;
            width: 6px;
            height: 6px;
            background: #000;
        }

        .export-text {
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            white-space: pre-wrap;
            text-align: left; /* ä¸¥æ ¼å·¦å¯¹é½ */
            margin-bottom: 16px;
        }

        /* å¼ºåˆ¶3åˆ—ç½‘æ ¼ */
        .export-images {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 16px;
        }
        
        .export-img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover; /* ç¡®ä¿å›¾ç‰‡è£å‰ªå±…ä¸­ */
            object-position: center;
            display: block;
            border-radius: 0;
            border: 1px solid rgba(0,0,0,0.05);
            background: #e0e0e0;
        }

        .export-footer-simple {
            margin-top: 60px;
            padding-top: 24px;
            border-top: 2px solid #000;
            display: flex;
            flex-direction: column;
            gap: 6px;
            text-align: left; /* ä¸¥æ ¼å·¦å¯¹é½ */
        }

        .footer-brand {
            font-size: 14px;
            font-weight: 700;
            color: #000;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .footer-sub {
            font-size: 12px;
            color: #666;
            font-family: 'Space Grotesk', monospace;
        }

        /* æ¨¡æ€æ¡† */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }
        .modal-content {
            background: var(--panel);
            /* ç§»é™¤ç»Ÿä¸€ Paddingï¼Œæ”¹ç”±å„éƒ¨åˆ†æ§åˆ¶ */
            padding: 0; 
            border-radius: 12px;
            width: 90%;
            max-width: 400px; /* é™åˆ¶æœ€å¤§å®½åº¦ */
            /* é™åˆ¶é«˜åº¦ï¼Œç•™å‡ºä½™é‡ */
            height: 85vh; 
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.6);
            border: 1px solid var(--stroke);
            overflow: hidden;
        }

        .modal-header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            flex-shrink: 0; /* é˜²æ­¢å¤´éƒ¨è¢«å‹ç¼© */
        }
        
        .modal-title {
            margin: 0;
            color: var(--txt);
            font-size: 16px;
            font-weight: bold;
        }

        .close-modal-btn {
            background: transparent;
            border: none;
            color: var(--muted);
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .close-modal-btn:hover {
            background: rgba(255,255,255,0.1);
            color: var(--txt);
        }

        /* å›¾ç‰‡å®¹å™¨ï¼šå æ®å‰©ä½™ç©ºé—´ï¼Œå¼ºåˆ¶ç¼©æ”¾ */
        #modalImgContainer {
            flex: 1;
            width: 100%;
            /* å…³é”®ï¼šmin-height: 0 å…è®¸ flex å­é¡¹ç¼©å° */
            min-height: 0; 
            overflow: hidden; /* ç¦æ­¢æ»šåŠ¨ */
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px; /* ç»™å›¾ç‰‡ç•™ç‚¹å‘¼å¸ç©ºé—´ */
            box-sizing: border-box;
            background: rgba(0,0,0,0.2); /*ç¨å¾®æ·±ä¸€ç‚¹çš„èƒŒæ™¯è¡¬æ‰˜å›¾ç‰‡*/
        }

        .generated-img {
            /* å¼ºåˆ¶å›¾ç‰‡é€‚åº”å®¹å™¨å¤§å° */
            max-height: 100%;
            max-width: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .modal-footer-row {
            padding: 12px;
            text-align: center;
            border-top: 1px solid rgba(255,255,255,0.05);
            flex-shrink: 0;
        }
        
        .save-tip {
            color: var(--primary);
            margin: 0;
            font-size: 13px;
        }
        .save-tip {
            color: var(--primary);
            margin-top: 15px;
            font-size: 14px;
            margin-bottom: 5px;
        }

        /* å›¾ç‰‡æµ®å±‚ */
        .image-lightbox {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            cursor: zoom-out;
            animation: fadeIn 0.2s ease;
        }

        .image-lightbox.show {
            display: flex;
        }

        .image-lightbox img {
            max-width: 90%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
            cursor: default;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            z-index: 2001;
            backdrop-filter: blur(10px);
        }

        .lightbox-close:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-content">
            <span class="pixel-h" style="font-size: 14px;">æ‰“å¡å›é¡¾</span>
            <a href="/checkin" class="btn-text pixel-h" style="font-size: 12px;">[è¿”å›æ‰“å¡]</a>
        </div>
    </nav>

    <div class="container">
        <div class="history-header">
            <h1 class="pixel-h" style="font-size: 20px; color: var(--green);">æ‰“å¡å›é¡¾</h1>
            <input type="date" id="datePicker" class="pixel-input" style="width: auto; padding: 6px 10px; font-size: 12px;">
        </div>

        <div class="date-scroll-container">
            <div class="date-nav" id="dateNav">
                <!-- JS ç”Ÿæˆæ—¥æœŸèƒ¶å›Š -->
            </div>
        </div>

        <div id="feedList" class="waterfall">
            <div class="pixel-card">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <!-- éšè—çš„å¯¼å‡ºå®¹å™¨ -->
    <div id="export-container">
        <!-- è£…é¥°æ€§èƒŒæ™¯å…ƒç´ ï¼Œç¡®ä¿ html2canvas èƒ½æ•æ‰åˆ° -->
        <div class="deco-circle"></div>
        <div class="deco-grid"></div>
        <div class="deco-corner top-left"></div>
        <div class="deco-corner bottom-right"></div>

        <div class="export-header-simple">
            <div class="export-user-block">
                <h1 id="exportUsername">User</h1>
                <p id="exportTime">2023-10-27 10:30</p>
            </div>
            <img src="/é»‘è‰²ai798.svg" class="export-logo" alt="ai798">
        </div>

        <div id="exportContent">
            <!-- åŠ¨æ€å¡«å……å†…å®¹ -->
        </div>

        <div class="export-footer-simple">
            <div class="footer-brand">ai798å®æˆ˜è¥</div>
            <div class="footer-sub">æˆé•¿æ—¥å¿—</div>
        </div>
    </div>

    <!-- å›¾ç‰‡å±•ç¤ºæ¨¡æ€æ¡†ï¼ˆåˆ†äº«ç”Ÿæˆçš„é•¿å›¾ï¼‰ -->
    <div class="modal-overlay" id="imgModal">
        <div class="modal-content">
            <div class="modal-header-row">
                <h3 class="modal-title">ğŸ‰ ç”ŸæˆæˆåŠŸ</h3>
                <button class="close-modal-btn" onclick="closeModal()">Ã—</button>
            </div>
            
            <div id="modalImgContainer"></div>
            
            <div class="modal-footer-row">
                <p class="save-tip">é•¿æŒ‰å›¾ç‰‡ä¿å­˜æˆ–åˆ†äº«</p>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡æµ®å±‚ï¼ˆæŸ¥çœ‹æ‰“å¡å›¾ç‰‡ï¼‰ -->
    <div class="image-lightbox" id="imageLightbox" onclick="closeLightbox()">
        <button class="lightbox-close" onclick="closeLightbox()">Ã—</button>
        <img id="lightboxImg" src="" alt="æŸ¥çœ‹å¤§å›¾">
    </div>

    <script src="supabase.js"></script>
    <script src="app.js?v=2.0"></script>
    <script src="particles-bg.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initHistoryPage();
        });
    </script>
</body>
</html>
