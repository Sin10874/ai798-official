# è¯„è®ºæ¨¡å—åŠŸèƒ½æ›´æ–°è¯´æ˜

## æ›´æ–°æ—¥æœŸ
2025-11-27

## æ›´æ–°å†…å®¹

### 1. äºŒçº§è¯„è®ºå›å¤åŠŸèƒ½ âœ¨

**åŠŸèƒ½æè¿°ï¼š**
- äºŒçº§è¯„è®ºç°åœ¨ä¹Ÿå¯ä»¥è¢«å›å¤
- å›å¤äºŒçº§è¯„è®ºæ—¶ï¼Œæ–°è¯„è®ºä¼šä½œä¸ºåŒçº§çš„äºŒçº§è¯„è®ºå‡ºç°ï¼ˆä¸ä¼šå½¢æˆä¸‰çº§åµŒå¥—ï¼‰
- æ‰€æœ‰å›å¤éƒ½ä¼šå¹³çº§æ˜¾ç¤ºåœ¨ä¸€çº§è¯„è®ºä¸‹æ–¹

**å®ç°ç»†èŠ‚ï¼š**
- äºŒçº§è¯„è®ºå¢åŠ äº†"å›å¤"æŒ‰é’®
- å›å¤äºŒçº§è¯„è®ºæ—¶ï¼Œæ–°è¯„è®ºçš„ `parent_id` æŒ‡å‘åŸå§‹çš„ä¸€çº§è¯„è®º
- è¿™æ ·ä¿æŒäº†æ‰å¹³çš„è¯„è®ºç»“æ„ï¼Œä¾¿äºé˜…è¯»å’Œç»´æŠ¤

**ç”¨æˆ·ä½“éªŒï¼š**
- å¯ä»¥é’ˆå¯¹ä»»ä½•è¯„è®ºè¿›è¡Œå›å¤
- æ‰€æœ‰ç›¸å…³è®¨è®ºéƒ½é›†ä¸­åœ¨åŒä¸€ä¸ªè¯„è®ºåŒºåŸŸ
- é¿å…äº†æ·±å±‚åµŒå¥—å¸¦æ¥çš„é˜…è¯»å›°éš¾

---

### 2. ç‚¹èµåŠŸèƒ½ï¼ˆğŸ‘ï¼‰ ğŸ’–

**åŠŸèƒ½èŒƒå›´ï¼š**
1. **æ‰“å¡å†…å®¹ç‚¹èµ**
   - æ¯æ¡æ‰“å¡å†…å®¹ä¸‹æ–¹æ˜¾ç¤ºç‚¹èµæŒ‰é’®
   - ç‚¹å‡»å¯ç‚¹äº®å¹¶å¢åŠ æ•°é‡
   - æ˜¾ç¤ºå½“å‰ç‚¹èµæ€»æ•°

2. **è¯„è®ºç‚¹èµ**
   - ä¸€çº§è¯„è®ºå¯ä»¥ç‚¹èµ
   - äºŒçº§è¯„è®ºä¹Ÿå¯ä»¥ç‚¹èµ
   - æ‰€æœ‰è¯„è®ºéƒ½æœ‰ç‹¬ç«‹çš„ç‚¹èµç»Ÿè®¡

**äº¤äº’ç‰¹æ€§ï¼š**
- âœ… ç‚¹å‡»ç‚¹èµï¼šæŒ‰é’®é«˜äº®ï¼Œæ•°é‡+1ï¼Œå¸¦åŠ¨ç”»æ•ˆæœ
- âœ… å†æ¬¡ç‚¹å‡»ï¼šå–æ¶ˆç‚¹èµï¼Œæ•°é‡-1
- âœ… åŒä¸€ç”¨æˆ·å¯¹åŒä¸€ç›®æ ‡åªèƒ½ç‚¹èµä¸€æ¬¡
- âœ… ç‚¹èµæ•°ä¸º0æ—¶ä¸æ˜¾ç¤ºæ•°å­—ï¼ˆä¿æŒç•Œé¢æ•´æ´ï¼‰
- âœ… å·²ç‚¹èµçŠ¶æ€æŒä¹…åŒ–ä¿å­˜

**è§†è§‰è®¾è®¡ï¼š**
- æœªç‚¹èµï¼šç°è‰²åŠé€æ˜æŒ‰é’®
- å·²ç‚¹èµï¼šé»„è‰²é«˜äº®æŒ‰é’®ï¼Œå¸¦åŠ¨ç”»æ•ˆæœ
- é¼ æ ‡æ‚¬åœï¼šæŒ‰é’®ä¸Šæµ®æ•ˆæœ

---

### 3. è¯„è®ºæ•°ç»Ÿè®¡ä¼˜åŒ– ğŸ“Š

**æ–°çš„ç»Ÿè®¡è§„åˆ™ï¼š**
- è¯„è®ºæ•° = ä¸€çº§è¯„è®ºæ•° + äºŒçº§è¯„è®ºæ•°
- åŒ…å«äº†æ‰€æœ‰å±‚çº§çš„è¯„è®º

**æ˜¾ç¤ºè§„åˆ™ï¼š**
- è¯„è®ºæ•° > 0ï¼šæ˜¾ç¤ºå…·ä½“æ•°å­—
- è¯„è®ºæ•° = 0ï¼šä¸æ˜¾ç¤ºæ•°å­—ï¼ˆä¹‹å‰ä¼šæ˜¾ç¤º"0"ï¼‰
- ä½¿ç”¨ `display: none` éšè—ï¼Œè€Œéåªæ˜¯ä¸æ˜¾ç¤ºå†…å®¹

---

## æ•°æ®åº“å˜æ›´

### æ–°å¢è¡¨ï¼šlikes

éœ€è¦åœ¨ Supabase ä¸­æ‰§è¡Œ `likes_table.sql`ï¼š

```sql
CREATE TABLE IF NOT EXISTS likes (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    target_type TEXT NOT NULL CHECK (target_type IN ('checkin', 'comment')),
    target_id UUID NOT NULL,
    user_id UUID NOT NULL,
    user_name TEXT NOT NULL,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(target_type, target_id, user_id)
);
```

**å­—æ®µè¯´æ˜ï¼š**
- `target_type`: ç‚¹èµç›®æ ‡ç±»å‹ï¼ˆ'checkin' æˆ– 'comment'ï¼‰
- `target_id`: ç›®æ ‡IDï¼ˆæ‰“å¡IDæˆ–è¯„è®ºIDï¼‰
- `user_id`: ç‚¹èµç”¨æˆ·ID
- `user_name`: ç‚¹èµç”¨æˆ·åç§°
- å”¯ä¸€çº¦æŸç¡®ä¿ç”¨æˆ·ä¸èƒ½é‡å¤ç‚¹èµ

---

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

### 1. **likes_table.sql** âœ¨ æ–°å¢
- ç‚¹èµè¡¨çš„SQLåˆ›å»ºè„šæœ¬
- åŒ…å«ç´¢å¼•å’ŒRLSç­–ç•¥

### 2. **supabase.js**
æ–°å¢å‡½æ•°ï¼š
- `getLikes(targetType, targetId)` - è·å–æŸä¸ªç›®æ ‡çš„æ‰€æœ‰ç‚¹èµ
- `getLikesCounts(targetType, targetIds)` - æ‰¹é‡è·å–ç‚¹èµæ•°
- `addLike(...)` - æ·»åŠ ç‚¹èµ
- `removeLike(...)` - å–æ¶ˆç‚¹èµ
- `checkUserLike(...)` - æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç‚¹èµ
- `checkUserLikes(...)` - æ‰¹é‡æ£€æŸ¥ç‚¹èµçŠ¶æ€

### 3. **app.js**
ä¿®æ”¹çš„å‡½æ•°ï¼š
- `renderComment()` - æ·»åŠ ç‚¹èµæŒ‰é’®ï¼Œä¿®æ”¹å›å¤é€»è¾‘
- `renderReply()` - äºŒçº§è¯„è®ºæ·»åŠ å›å¤å’Œç‚¹èµæŒ‰é’®
- `loadComments()` - åŠ è½½è¯„è®ºååŒæ—¶åŠ è½½ç‚¹èµæ•°æ®ï¼Œä¼˜åŒ–è¯„è®ºæ•°ç»Ÿè®¡
- `submitReply()` - æ”¯æŒäºŒçº§è¯„è®ºå›å¤ï¼Œç¡®ä¿parent_idæ­£ç¡®
- `showReplyInput()` - æ”¯æŒäºŒçº§è¯„è®ºçš„å›å¤è¾“å…¥æ¡†

æ–°å¢å‡½æ•°ï¼š
- `toggleLike(targetType, targetId)` - åˆ‡æ¢ç‚¹èµçŠ¶æ€
- `loadLikesForCheckins(checkinIds)` - æ‰¹é‡åŠ è½½æ‰“å¡ç‚¹èµæ•°æ®
- `loadLikesForComments(commentIds)` - æ‰¹é‡åŠ è½½è¯„è®ºç‚¹èµæ•°æ®

### 4. **style.css**
æ–°å¢æ ·å¼ï¼š
- `.checkin-actions` - æ‰“å¡å†…å®¹æ“ä½œåŒºåŸŸ
- `.like-btn` - ç‚¹èµæŒ‰é’®åŸºç¡€æ ·å¼
- `.like-btn.liked` - å·²ç‚¹èµçŠ¶æ€æ ·å¼
- `.like-btn.small` - è¯„è®ºåŒºå°å·ç‚¹èµæŒ‰é’®
- `@keyframes likeAnimation` - ç‚¹èµåŠ¨ç”»æ•ˆæœ

---

## éƒ¨ç½²æ­¥éª¤

### 1. åˆ›å»ºç‚¹èµè¡¨
1. ç™»å½• Supabase Dashboard
2. è¿›å…¥ SQL Editor
3. æ‰§è¡Œ `likes_table.sql` ä¸­çš„SQLä»£ç 
4. ç¡®è®¤è¡¨åˆ›å»ºæˆåŠŸ

### 2. éªŒè¯RLSç­–ç•¥
ç¡®è®¤ä»¥ä¸‹ç­–ç•¥å·²åˆ›å»ºï¼š
- âœ… æ‰€æœ‰äººå¯ä»¥æŸ¥çœ‹ç‚¹èµ
- âœ… ç™»å½•ç”¨æˆ·å¯ä»¥ç‚¹èµ
- âœ… ç”¨æˆ·åªèƒ½åˆ é™¤è‡ªå·±çš„ç‚¹èµ

### 3. æ›´æ–°å‰ç«¯æ–‡ä»¶
æ›¿æ¢ä»¥ä¸‹æ–‡ä»¶ï¼š
- `supabase.js`
- `app.js`
- `style.css`

### 4. æµ‹è¯•åŠŸèƒ½
- [ ] æµ‹è¯•æ‰“å¡å†…å®¹ç‚¹èµ
- [ ] æµ‹è¯•ä¸€çº§è¯„è®ºç‚¹èµ
- [ ] æµ‹è¯•äºŒçº§è¯„è®ºç‚¹èµ
- [ ] æµ‹è¯•äºŒçº§è¯„è®ºå›å¤
- [ ] æµ‹è¯•è¯„è®ºæ•°æ˜¾ç¤ºï¼ˆ0æ—¶ä¸æ˜¾ç¤ºï¼‰
- [ ] æµ‹è¯•ç‚¹èµçŠ¶æ€æŒä¹…åŒ–

---

## æŠ€æœ¯ç‰¹æ€§

### æ€§èƒ½ä¼˜åŒ–
- âœ… æ‰¹é‡åŠ è½½ç‚¹èµæ•°æ®ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
- âœ… ä½¿ç”¨å”¯ä¸€çº¦æŸé˜²æ­¢é‡å¤ç‚¹èµ
- âœ… å‰ç«¯çŠ¶æ€æ›´æ–°å³æ—¶å“åº”ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

### å®‰å…¨ç‰¹æ€§
- âœ… RLSç­–ç•¥ä¿æŠ¤æ•°æ®å®‰å…¨
- âœ… å”¯ä¸€çº¦æŸé˜²æ­¢åˆ·èµ
- âœ… ç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±çš„ç‚¹èµ

### ç”¨æˆ·ä½“éªŒ
- âœ… æµç•…çš„åŠ¨ç”»æ•ˆæœ
- âœ… å³æ—¶çš„è§†è§‰åé¦ˆ
- âœ… æ¸…æ™°çš„äº¤äº’çŠ¶æ€
- âœ… å“åº”å¼è®¾è®¡

---

## API å˜æ›´

### æ–°å¢ API

#### ç‚¹èµç›¸å…³
```javascript
// æ·»åŠ ç‚¹èµ
await addLike('checkin', checkinId, userId, userName);
await addLike('comment', commentId, userId, userName);

// å–æ¶ˆç‚¹èµ
await removeLike('checkin', checkinId, userId);
await removeLike('comment', commentId, userId);

// è·å–ç‚¹èµæ•°
const counts = await getLikesCounts('checkin', [id1, id2, id3]);
const counts = await getLikesCounts('comment', [id1, id2, id3]);

// æ£€æŸ¥ç‚¹èµçŠ¶æ€
const liked = await checkUserLike('checkin', checkinId, userId);
const likedMap = await checkUserLikes('comment', [id1, id2], userId);
```

#### å…¨å±€å‡½æ•°
```javascript
// åˆ‡æ¢ç‚¹èµï¼ˆå·²æš´éœ²åˆ°windowå¯¹è±¡ï¼‰
window.toggleLike('checkin', checkinId);
window.toggleLike('comment', commentId);
```

---

## å…¼å®¹æ€§è¯´æ˜

### æ•°æ®å…¼å®¹æ€§
- âœ… å®Œå…¨å…¼å®¹ç°æœ‰çš„æ‰“å¡æ•°æ®
- âœ… å®Œå…¨å…¼å®¹ç°æœ‰çš„è¯„è®ºæ•°æ®
- âœ… æ–°å¢çš„ç‚¹èµåŠŸèƒ½ä¸å½±å“å·²æœ‰åŠŸèƒ½

### æµè§ˆå™¨å…¼å®¹æ€§
- âœ… Chrome/Edge (æ¨è)
- âœ… Firefox
- âœ… Safari
- âš ï¸  IE ä¸æ”¯æŒï¼ˆæœ¬é¡¹ç›®å·²ä¸æ”¯æŒIEï¼‰

---

## å·²çŸ¥é—®é¢˜

æš‚æ— 

---

## åç»­ä¼˜åŒ–å»ºè®®

1. **é€šçŸ¥åŠŸèƒ½**
   - è¢«ç‚¹èµæ—¶é€šçŸ¥ç”¨æˆ·
   - è¢«å›å¤æ—¶é€šçŸ¥ç”¨æˆ·

2. **ç‚¹èµåˆ—è¡¨**
   - æ˜¾ç¤ºè°ç‚¹äº†èµ
   - ç‚¹èµç”¨æˆ·åˆ—è¡¨å¼¹çª—

3. **çƒ­åº¦æ’åº**
   - æ ¹æ®ç‚¹èµæ•°æ’åºæ‰“å¡å†…å®¹
   - æ ¹æ®ç‚¹èµæ•°æ’åºçƒ­é—¨è¯„è®º

4. **ç»Ÿè®¡åˆ†æ**
   - ç”¨æˆ·è·èµæ€»æ•°ç»Ÿè®¡
   - æœ€å—æ¬¢è¿å†…å®¹æ’è¡Œ

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿã€‚

---

**ç‰ˆæœ¬ï¼š** v2.0.0  
**æœ€åæ›´æ–°ï¼š** 2025-11-27

